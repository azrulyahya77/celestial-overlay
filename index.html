<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Celestial Overlay</title>
  <style>
    body {
      margin: 0;
      font-family: 'Cinzel', serif;
      color: #fff;
      background: transparent;
      text-align: center;
      padding-top: 20px;
    }
    #celestial {
      font-size: 2em;
      text-shadow: 0 0 10px #000;
    }
    .sun {
      color: #FFD700;
    }
    .moon {
      color: #B0C4DE;
    }
    .error {
      color: #FF6347;
    }
  </style>
</head>
<body>
  <div id="celestial">üåå Loading celestial data...</div>

  <script>
    const lat = 2.8652;  // Dengkil latitude
    const lon = 101.6781; // Dengkil longitude

    async function updateCelestial() {
      const celestialDiv = document.getElementById("celestial");
      const now = new Date();
      const today = now.toISOString().split("T")[0];

      try {
        const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=sunrise,sunset,moon_phase&timezone=auto`);
        const data = await res.json();

        const sunriseStr = data.daily.sunrise[0];
        const sunsetStr = data.daily.sunset[0];
        const moonPhaseNum = data.daily.moon_phase[0];

        const sunrise = new Date(sunriseStr);
        const sunset = new Date(sunsetStr);

        const moonPhases = [
          "New Moon", "Waxing Crescent", "First Quarter", "Waxing Gibbous",
          "Full Moon", "Waning Gibbous", "Last Quarter", "Waning Crescent"
        ];
        const moonEmojis = ["üåë", "üåí", "üåì", "üåî", "üåï", "üåñ", "üåó", "üåò"];
        const phaseIndex = Math.round(moonPhaseNum) % 8;
        const moonPhase = moonPhases[phaseIndex];
        const moonEmoji = moonEmojis[phaseIndex];

        if (now >= sunrise && now <= sunset) {
          const sunEmoji = "‚òÄÔ∏è";
          const hour = now.getHours();
          const brightness = Math.round((1 - Math.abs(12 - hour) / 12) * 100);
          celestialDiv.innerHTML = `<span class="sun">${sunEmoji} Sun is shining (${brightness}% brightness)</span>`;
        } else {
          celestialDiv.innerHTML = `<span class="moon">${moonEmoji} Moon Phase: ${moonPhase}</span>`;
        }
      } catch (error) {
        console.error("Celestial fetch error:", error);
        celestialDiv.innerHTML = `<span class="error">‚ö†Ô∏è Unable to fetch celestial data</span>`;
      }
    }

    updateCelestial();
    setInterval(updateCelestial, 60000); // Update every minute
  </script>
</body>
</html>
