<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Celestial Overlay</title>
  <style>
    body {
      margin: 0;
      font-family: 'Cinzel', serif;
      color: #fff;
      background: transparent;
      text-align: center;
      padding-top: 20px;
    }
    #celestial {
      font-size: 2em;
      text-shadow: 0 0 10px #000;
    }
    .sun {
      color: #FFD700;
    }
    .moon {
      color: #B0C4DE;
    }
    .error {
      color: #FF6347;
    }
  </style>
</head>
<body>
  <div id="celestial">ğŸŒŒ Loading celestial data...</div>

  <script>
    const lat = 2.8652;  // Dengkil latitude
    const lon = 101.6781; // Dengkil longitude

    async function updateCelestial() {
      const celestialDiv = document.getElementById("celestial");
      const now = new Date();

      try {
        // Fetch sun data
        const sunRes = await fetch(`https://api.sunrisesunset.io/json?lat=${lat}&lng=${lon}&date=today`);
        const sunJson = await sunRes.json();
        const sunrise = new Date(sunJson.results.sunrise);
        const sunset = new Date(sunJson.results.sunset);

        // Fetch moon phase
        const timestamp = Math.floor(now.getTime() / 1000);
        const moonRes = await fetch(`https://api.farmsense.net/v1/moonphases/?d=${timestamp}`);
        const moonJson = await moonRes.json();
        const moonPhase = moonJson[0]?.Phase || "Unknown";

        // Determine celestial state
        if (now >= sunrise && now <= sunset) {
          const sunEmoji = "â˜€ï¸";
          const hour = now.getHours();
          const brightness = Math.round((1 - Math.abs(12 - hour) / 12) * 100);
          celestialDiv.innerHTML = `<span class="sun">${sunEmoji} Sun is shining (${brightness}% brightness)</span>`;
        } else {
          const moonEmojis = {
            "New Moon": "ğŸŒ‘",
            "Waxing Crescent": "ğŸŒ’",
            "First Quarter": "ğŸŒ“",
            "Waxing Gibbous": "ğŸŒ”",
            "Full Moon": "ğŸŒ•",
            "Waning Gibbous": "ğŸŒ–",
            "Last Quarter": "ğŸŒ—",
            "Waning Crescent": "ğŸŒ˜"
          };
          const moonEmoji = moonEmojis[moonPhase] || "ğŸŒ™";
          celestialDiv.innerHTML = `<span class="moon">${moonEmoji} Moon Phase: ${moonPhase}</span>`;
        }
      } catch (error) {
        console.error("Celestial fetch error:", error);
        celestialDiv.innerHTML = `<span class="error">âš ï¸ Unable to fetch celestial data</span>`;
      }
    }

    updateCelestial();
    setInterval(updateCelestial, 60000); // Update every minute
  </script>
</body>
</html>
